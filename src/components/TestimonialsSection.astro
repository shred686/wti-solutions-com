---
export interface Props {
  backgroundImage?: string;
  overlayColor?: string;
  overlayOpacity?: number;
  backgroundStyle?: string;
  id?: string;
}

const { backgroundImage, overlayColor, overlayOpacity = 50, backgroundStyle, id } = Astro.props;

// Convert percentage to decimal for CSS
const overlayOpacityDecimal = overlayOpacity / 100;

// Set default overlay color only if overlayColor is provided
const finalOverlayColor = overlayColor || 'black';

// Testimonials data from old site
const testimonials = [
  {
    quote: "WTI employs exceptional Subject Matter Expertise, and they provide exceptional results to our programs and objectives.",
    author: "U.S. Air Force"
  },
  {
    quote: "Contractor has maintained effective and viable control measures throughout the period and as a result all factors have been well within anticipated cost levels and contract limits, without flaw of exception.",
    author: "Colonel, USAF"
  },
  {
    quote: "WTI has exhibited exceptional management of subcontractor operations during the term of this contract and as a prime contractor, ensured all contracting staff performed as one seamless team. This is evidenced by meeting all criteria for inspections, week/quarterly program reports, and contractor communications with Government personnel and subcontractors.",
    author: "Colonel, USAF"
  },
  {
    quote: "It has been a pleasure working with you and all the quality folks you have provided!",
    author: "Branch Chief, USAF Major Command"
  },
  {
    quote: "Just finished reading the (document). I LOVE it! Best description I've seen on how we want to leverage modern data management principles in a consistent and effective fashion.",
    author: "USAF ISR Chief Architect"
  },
  {
    quote: "'Go-To' vendor and first stop for success stories. Seeking 'modernization at the speed of relevance' and only vendor who can match this statement when it comes to rapid capability delivery and modernization updates.",
    author: "DCGS Gov Lead"
  },
  {
    quote: "I wanted to take a second and thank you for the brilliant support of your employees",
    author: "Senior Intelligence Integration Officer, Office of Naval Intelligence"
  }
];
---

<style>
  .swiper {
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  
  .swiper-slide {
    text-align: center;
    font-size: 18px;
    background: transparent;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  
  .swiper-slide img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .swiper-button-next,
  .swiper-button-prev {
    color: #666;
    background: rgba(255, 255, 255, 0.9);
    width: 44px;
    height: 44px;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
  }
  
  .swiper-button-next {
    right: 10px;
  }
  
  .swiper-button-prev {
    left: 10px;
  }
  
  .swiper-button-next:hover,
  .swiper-button-prev:hover {
    background: rgba(255, 255, 255, 1);
    color: #333;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    transform: translateY(-50%) scale(1.05);
  }
  
  .swiper-button-next:after,
  .swiper-button-prev:after {
    font-size: 18px;
    font-weight: 600;
  }
  
  .swiper-pagination-bullet {
    background: #e5e5e5;
    opacity: 0.5;
  }
  
  .swiper-pagination-bullet-active {
    opacity: 1;
    background: #e5e5e5;
  }
  
  .testimonial-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    margin: 0 10px;
  }
  
  .testimonial-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  }
  
  .swiper-slide {
    height: auto;
  }
  
  .swiper-container-wrapper {
    position: relative;
    padding: 0 60px;
  }
</style>

<section class={backgroundImage ? "h-screen relative overflow-hidden" : "py-16"} data-section-type="testimonials" id={id} style={backgroundImage ? `background-image: url(${backgroundImage}); background-size: cover; background-position: center; background-repeat: no-repeat;` : (backgroundStyle || 'background: white;')}>
  {backgroundImage && overlayColor && (
    <div 
      class="absolute inset-0 z-0" 
      style={`background-color: ${finalOverlayColor === 'white' ? 'rgba(255, 255, 255, ' : 'rgba(0, 0, 0, '}${overlayOpacityDecimal});`}
    ></div>
  )}
  <div class={backgroundImage ? "relative z-10 w-full h-full flex items-center justify-center p-8" : "w-full px-4 sm:px-6 lg:px-8"}>
    {backgroundImage && overlayColor ? (
      <div class="w-full max-w-7xl backdrop-blur-sm bg-white/20 border border-white/30 shadow-xl rounded-2xl p-12">
        <div class="text-center mb-12 bg-[#1a1a1a] p-8 border border-[var(--dark-accent-color)]">
          <h2 class="text-4xl md:text-5xl font-light text-[var(--dark-header-color)] mb-6">
            What Our Clients Are Saying
          </h2>
          <hr class="w-full max-w-3xl mx-auto mb-6 border-[var(--dark-accent-color)]">
          <p class="text-xl text-[var(--dark-body-color)] max-w-3xl mx-auto">
            Trusted partnerships built on delivering exceptional results
          </p>
        </div>
        
        <!-- Swiper Container -->
        <div class="swiper-container-wrapper">
          <div class="swiper testimonials-swiper">
            <div class="swiper-wrapper">
              {testimonials.map((testimonial) => (
                <div class="swiper-slide">
                  <div class="testimonial-card bg-silver-charcoal-50 p-6 rounded-lg shadow-sm border border-silver-charcoal-200">
                    <div>
                      <p class="text-silver-charcoal-600 mb-4 leading-relaxed text-lg">
                        "{testimonial.quote}"
                      </p>
                      <div>
                        <div class="text-sm font-medium text-silver-charcoal-900">{testimonial.author}</div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
            
            <!-- Pagination dots -->
            <div class="swiper-pagination"></div>
          </div>
          
          <!-- Navigation arrows -->
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
    ) : (
      <div class="w-full px-4 sm:px-6 lg:px-8 py-6">
        <div class="text-center mb-12 bg-[#1a1a1a] p-8 border border-[var(--dark-accent-color)]">
          <h2 class="text-4xl md:text-5xl font-light text-[var(--dark-header-color)] mb-6">
            What Our Clients Are Saying
          </h2>
          <hr class="w-full max-w-3xl mx-auto mb-6 border-[var(--dark-accent-color)]">
          <p class="text-xl text-[var(--dark-body-color)] max-w-3xl mx-auto">
            Trusted partnerships built on delivering exceptional results
          </p>
        </div>
        
        <!-- Swiper Container -->
        <div class="swiper-container-wrapper">
          <div class="swiper testimonials-swiper">
            <div class="swiper-wrapper">
              {testimonials.map((testimonial) => (
                <div class="swiper-slide">
                  <div class="testimonial-card bg-silver-charcoal-50 p-6 rounded-lg shadow-sm border border-silver-charcoal-200">
                    <div>
                      <p class="text-silver-charcoal-600 mb-4 leading-relaxed text-lg">
                        "{testimonial.quote}"
                      </p>
                      <div>
                        <div class="text-sm font-medium text-silver-charcoal-900">{testimonial.author}</div>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
            
            <!-- Pagination dots -->
            <div class="swiper-pagination"></div>
          </div>
          
          <!-- Navigation arrows -->
          <div class="swiper-button-next"></div>
          <div class="swiper-button-prev"></div>
        </div>
      </div>
    )}
  </div>
</section>

<script>
  // Load Swiper from CDN
  const script = document.createElement('script');
  script.src = 'https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js';
  script.onload = function() {
    // Initialize Swiper after it's loaded
    initSwiper();
  };
  document.head.appendChild(script);

  function initSwiper() {
    // @ts-ignore - Swiper is loaded from CDN
    if (typeof Swiper !== 'undefined') {
      // @ts-ignore - Swiper is loaded from CDN
      const swiper = new Swiper('.testimonials-swiper', {
        // Enable automatic sliding every 5 seconds
        autoplay: {
          delay: 5000,
          disableOnInteraction: false,
        },
        
        // Enable loop for continuous sliding
        loop: true,
        
        // Enable navigation arrows
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        
        // Enable pagination dots
        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },
        
        // Responsive breakpoints
        breakpoints: {
          // Mobile
          320: {
            slidesPerView: 1,
            spaceBetween: 20
          },
          // Tablet
          768: {
            slidesPerView: 2,
            spaceBetween: 30
          },
          // Desktop
          1024: {
            slidesPerView: 3,
            spaceBetween: 40
          }
        },
        
        // Smooth transitions
        effect: 'slide',
        speed: 800,
        
        // Pause autoplay on hover
        pauseOnMouseEnter: true,
        
        // Resume autoplay when mouse leaves
        pauseOnMouseLeave: false
      });
      
      console.log('Swiper initialized successfully!');
    } else {
      console.log('Swiper not loaded yet, retrying...');
      setTimeout(initSwiper, 100);
    }
  }
</script> 

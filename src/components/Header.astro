---
export interface Props {
  transparent?: boolean;
}

const { transparent = false } = Astro.props;
const baseUrl = import.meta.env.BASE_URL;
---

<header 
  id="main-header"
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  class:list={{
    'bg-transparent': transparent,
    'backdrop-blur-sm border-b border-[var(--dark-accent-color)]': !transparent
  }}
  data-transparent={transparent}
  style={transparent ? 'background-color: transparent;' : 'background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1f1f1f 100%); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);'}
>
  <style>
    /* Hover effects for navigation links */
    .nav-link:hover {
      color: #ffffff !important;
    }
    
    /* Hover effects for CTA button when on dark background */
    #header-cta:hover {
      background-color: #2a2a2a !important;
      color: var(--dark-header-color) !important;
    }
    
    /* Hover effects for transparent background */
    .bg-transparent .nav-link:hover {
      color: #ffffff !important;
    }
    
    .bg-transparent #header-cta:hover {
      background-color: #1c222e !important;
    }

    /* Dropdown styles */
    .dropdown-container {
      position: relative;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      left: 0;
      min-width: 200px;
      background: rgba(26, 26, 26, 0.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(85, 107, 47, 0.3);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1000;
    }

    .dropdown-container:hover .dropdown-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: block;
      padding: 12px 16px;
      color: var(--dark-body-color);
      text-decoration: none;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(85, 107, 47, 0.1);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: rgba(85, 107, 47, 0.1);
      color: var(--dark-header-color);
      padding-left: 20px;
    }

    /* Mobile dropdown styles */
    .mobile-dropdown {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .mobile-dropdown.open {
      max-height: 300px;
    }

    .mobile-dropdown-item {
      padding-left: 24px;
      font-size: 0.9em;
      color: var(--dark-body-color);
    }
  </style>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href={baseUrl} class="transition-opacity hover:opacity-80" id="header-logo">
          <img 
            src={`${baseUrl}WTI-logo-type.png`} 
            alt="WTI Solutions" 
            class="h-10 w-auto"
          />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-8">
        <!-- Who We Are Dropdown -->
        <div class="dropdown-container">
          <a href={`${baseUrl}team-wti`} class="px-3 py-2 text-sm font-medium transition-colors nav-link text-[var(--dark-body-color)] flex items-center">
            Who We Are
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </a>
          <div class="dropdown-menu">
            <a href={`${baseUrl}#intro`} class="dropdown-item">Welcome</a>
            <a href={`${baseUrl}team-wti#leadership`} class="dropdown-item">Leadership Team</a>
            <a href={`${baseUrl}team-wti#technical-advisory-board`} class="dropdown-item">Technical Advisory Board</a>
            <a href={`${baseUrl}team-wti#advisory-board`} class="dropdown-item">Advisory Board</a>
            <a href={`${baseUrl}certifications`} class="dropdown-item">Certifications</a>
          </div>
        </div>

        <!-- What We Do Dropdown -->
        <div class="dropdown-container">
          <a href={`${baseUrl}capabilities`} class="px-3 py-2 text-sm font-medium transition-colors nav-link text-[var(--dark-body-color)] flex items-center">
            What We Do
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </a>
          <div class="dropdown-menu">
            <a href={`${baseUrl}capabilities`} class="dropdown-item">Capabilities</a>
            <a href={`${baseUrl}what-we-do/clients`} class="dropdown-item">Clients</a>
            <a href={`${baseUrl}case-studies`} class="dropdown-item">Case Studies</a>
          </div>
        </div>

        <!-- Contract Vehicles -->
        <a href={`${baseUrl}contract-vehicles`} class="px-3 py-2 text-sm font-medium transition-colors nav-link text-[var(--dark-body-color)]">
          Contract Vehicles
        </a>

        <!-- Careers Dropdown -->
        <div class="dropdown-container">
          <a href={`${baseUrl}careers`} class="px-3 py-2 text-sm font-medium transition-colors nav-link text-[var(--dark-body-color)] flex items-center">
            Careers
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </a>
          <div class="dropdown-menu">
            <a href={`${baseUrl}careers-culture-benefits`} class="dropdown-item">Culture & Benefits</a>
            <a href={`${baseUrl}careers-job-openings`} class="dropdown-item">Job Openings</a>
          </div>
        </div>

        <!-- News -->
        <a href={`${baseUrl}news`} class="px-3 py-2 text-sm font-medium transition-colors nav-link text-[var(--dark-body-color)]">
          News
        </a>

        <!-- Contact Button -->
        <a href={`${baseUrl}contact`} class="px-4 py-2 rounded-lg text-sm font-medium transition-colors text-[var(--dark-header-color)] border border-[var(--dark-accent-color)] hover:bg-[#2a2a2a] hover:text-[var(--dark-header-color)]" id="header-cta">
          Contact
        </a>
      </nav>

      <!-- Mobile menu button -->
      <div class="md:hidden">
        <button id="mobile-menu-button" type="button" class="bg-transparent p-2 rounded-md text-[var(--dark-header-color)] hover:text-[var(--dark-body-color)] focus:outline-none focus:ring-2 focus:ring-inset focus:ring-[var(--dark-header-color)]" aria-controls="mobile-menu" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <!-- Menu icon -->
          <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile menu -->
    <div class="md:hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-[#1a1a1a] border-t border-[var(--dark-accent-color)]">
        <!-- Who We Are Mobile -->
        <div class="mobile-dropdown-container">
          <button class="mobile-dropdown-toggle text-[var(--dark-body-color)] hover:text-[var(--dark-header-color)] block px-3 py-2 text-base font-medium w-full text-left flex items-center justify-between">
            Who We Are
            <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="mobile-dropdown">
            <a href={`${baseUrl}#intro`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Welcome</a>
            <a href={`${baseUrl}team-wti#leadership`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Leadership Team</a>
            <a href={`${baseUrl}team-wti#technical-advisory-board`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Technical Advisory Board</a>
            <a href={`${baseUrl}team-wti#advisory-board`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Advisory Board</a>
            <a href={`${baseUrl}#certifications`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Certifications</a>
          </div>
        </div>

        <!-- What We Do Mobile -->
        <div class="mobile-dropdown-container">
          <button class="mobile-dropdown-toggle text-[var(--dark-body-color)] hover:text-[var(--dark-header-color)] block px-3 py-2 text-base font-medium w-full text-left flex items-center justify-between">
            What We Do
            <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="mobile-dropdown">
            <a href={`${baseUrl}capabilities`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Capabilities</a>
            <a href={`${baseUrl}what-we-do/clients`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Clients</a>
            <a href={`${baseUrl}case-studies`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Case Studies</a>
          </div>
        </div>

        <!-- Contract Vehicles Mobile -->
        <a href={`${baseUrl}contract-vehicles`} class="text-[var(--dark-body-color)] hover:text-[var(--dark-header-color)] block px-3 py-2 text-base font-medium">
          Contract Vehicles
        </a>

        <!-- Careers Mobile -->
        <div class="mobile-dropdown-container">
          <button class="mobile-dropdown-toggle text-[var(--dark-body-color)] hover:text-[var(--dark-header-color)] block px-3 py-2 text-base font-medium w-full text-left flex items-center justify-between">
            Careers
            <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div class="mobile-dropdown">
            <a href={`${baseUrl}careers-culture-benefits`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Culture & Benefits</a>
            <a href={`${baseUrl}careers-job-openings`} class="mobile-dropdown-item block px-3 py-2 text-base font-medium">Job Openings</a>
          </div>
        </div>

        <!-- News Mobile -->
        <a href={`${baseUrl}news`} class="text-[var(--dark-body-color)] hover:text-[var(--dark-header-color)] block px-3 py-2 text-base font-medium">
          News
        </a>

        <!-- Contact Mobile -->
        <a href={`${baseUrl}contact`} class="bg-[#2a2a2a] text-[var(--dark-header-color)] block px-3 py-2 rounded-md text-base font-medium hover:bg-[#1a1a1a]">
          Contact
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const header = document.getElementById('main-header');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const isTransparent = header?.getAttribute('data-transparent') === 'true';

    // Mobile menu functionality
    mobileMenuButton?.addEventListener('click', () => {
      mobileMenu?.classList.toggle('hidden');
    });

    // Mobile dropdown functionality
    const mobileDropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
    mobileDropdownToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const dropdown = toggle.nextElementSibling;
        const icon = toggle.querySelector('svg');
        
        if (dropdown && icon) {
          dropdown.classList.toggle('open');
          icon.style.transform = dropdown.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
        }
      });
    });

    // Close mobile menu when clicking on links
    const mobileLinks = mobileMenu?.querySelectorAll('a');
    mobileLinks?.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu?.classList.add('hidden');
        // Close all dropdowns
        const dropdowns = mobileMenu?.querySelectorAll('.mobile-dropdown');
        const icons = mobileMenu?.querySelectorAll('.mobile-dropdown-toggle svg');
        dropdowns?.forEach(dropdown => dropdown.classList.remove('open'));
        icons?.forEach(icon => icon.style.transform = 'rotate(0deg)');
      });
    });

    // Scroll effect for transparent header
    if (isTransparent && header) {
      const updateHeaderBackground = () => {
        const scrollY = window.scrollY;
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        
        if (scrollY > 50) {
          // Dark background when scrolled
          header.style.background = 'linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1f1f1f 100%)';
          header.style.backdropFilter = 'blur(8px)';
          header.style.webkitBackdropFilter = 'blur(8px)';
          header.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.4)';
          header.style.borderBottom = '1px solid var(--dark-accent-color)';
          header.classList.remove('bg-transparent');
          
          // Update text colors for dark background
          const logo = document.getElementById('header-logo');
          const navLinks = document.querySelectorAll('.nav-link');
          const ctaButton = document.getElementById('header-cta');
          
          // Logo is now an image, no color changes needed
          navLinks.forEach(link => {
            link.style.color = 'var(--dark-body-color)';
          });
          if (ctaButton) {
            ctaButton.style.backgroundColor = 'transparent';
            ctaButton.style.color = 'var(--dark-header-color)';
            ctaButton.style.border = '1px solid var(--dark-accent-color)';
          }
          if (mobileMenuButton) {
            mobileMenuButton.style.color = 'var(--dark-header-color)';
            mobileMenuButton.style.backgroundColor = 'transparent';
          }
        } else {
          // Transparent background when at top
          header.style.backgroundColor = 'transparent';
          header.style.background = 'transparent';
          header.style.opacity = '1';
          header.style.backdropFilter = 'none';
          header.style.borderBottom = 'none';
          header.classList.add('bg-transparent');
          
          // Update text colors for transparent background
          const logo = document.getElementById('header-logo');
          const navLinks = document.querySelectorAll('.nav-link');
          const ctaButton = document.getElementById('header-cta');
          
          // Logo is now an image, no color changes needed
          navLinks.forEach(link => {
            link.style.color = '#ffffff';
          });
          if (ctaButton) {
            ctaButton.style.backgroundColor = 'transparent';
            ctaButton.style.color = '#ffffff';
            ctaButton.style.border = '1px solid #ffffff';
          }
          if (mobileMenuButton) {
            mobileMenuButton.style.color = '#ffffff';
            mobileMenuButton.style.backgroundColor = 'transparent';
          }
        }
      };

      // Listen for scroll events
      window.addEventListener('scroll', updateHeaderBackground);
      
      // Initial setup
      updateHeaderBackground();
    }
  });
</script> 